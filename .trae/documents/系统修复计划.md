# 系统修复计划

针对您提出的两个问题，我将按以下计划进行修复：

## 1. 修复“暂无已部署工作流”问题
虽然我们禁用了后端缓存，但前端 `ChatView.vue` 加载逻辑可能仍有问题。
*   **检查点**: `ChatView.vue` 中 `loadAgents` 方法默认只拉取前 50 条。如果数据量大或排序不对，可能漏掉新部署的。
*   **优化**: 确认后端 `findAll` 的排序是 `updatedAt: 'DESC'`（已确认）。
*   **补充**: 在 `ChatView.vue` 加载完成后，如果列表为空，尝试强制调用一次 `fetch`，或者增加手动刷新按钮。但更重要的是，我需要确保 `ChatView` 能正确处理 `agents` 数组为空的情况，并给出正确的引导。

## 2. 修复“没有已执行节点”的运行错误
当您点击侧边栏的“运行”（侧三角键）时，提示“没有已执行节点”，这通常是因为前端在收集节点数据时逻辑有误。
*   **根本原因**: `runWorkflow` 方法中，`calculateExecutionOrder` 依赖 `nodes.value`。如果 `nodes` 是 `shallowRef` 且数据结构被 Vue Flow 内部修改过，可能导致依赖关系计算错误。或者，`executedNodes` 状态未正确重置。
*   **更可能的错误**: 在 `ExecutionDialog` 或直接运行时，输入参数可能未正确传递，或者 `nodes` 数组为空（虽然您看到了节点）。
*   **关键发现**: 在 `WorkflowView.vue` 的 `runWorkflow` 中，`executionOrder` 计算逻辑可能对某些图结构（如孤立节点或特定连接）处理不当，导致返回空数组。

## 执行步骤

1.  **修复 `WorkflowView.vue`**:
    *   检查 `runWorkflow` 中的 `calculateExecutionOrder` 逻辑。
    *   确保在运行前正确保存并获取最新的 `nodes` 和 `edges`。
    *   增加对“无节点”或“无执行顺序”的显式检查和提示。

2.  **优化 `ChatView.vue`**:
    *   在“暂无已部署工作流”时，提供一个“刷新”按钮。
    *   检查 `status` 过滤逻辑（目前代码里似乎把所有 fetch 到的都设为 `inactive`，点击才变 `active`，这没问题）。

3.  **验证**:
    *   重启前端。
    *   再次进入工作流，点击运行，确认不再报错。
    *   进入对话页面，确认能刷出列表。