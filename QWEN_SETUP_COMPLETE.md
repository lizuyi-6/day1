# âœ… Qwen (é€šä¹‰åƒé—®) API é…ç½®å®ŒæˆæŠ¥å‘Š

## ğŸ‰ é…ç½®æˆåŠŸï¼

**LLM çŠ¶æ€**: âœ… å·²æˆåŠŸåˆå§‹åŒ–å¹¶è¿è¡Œ
```
âœ… LLM initialized: qwen-flash @ https://dashscope.aliyuncs.com/compatible-mode/v1
```

---

## ğŸ“‹ å·²å®Œæˆçš„é…ç½®

### 1. âœ… ç¯å¢ƒå˜é‡é…ç½®
**æ–‡ä»¶**: `docker-compose.yml`

```yaml
environment:
  - OPENAI_API_KEY=[REDACTED]
  - OPENAI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
  - LLM_MODEL=qwen-flash
```

### 2. âœ… åç«¯ä»£ç æ›´æ–°

#### Knowledge Service (knowledge.service.ts)
- é›†æˆ OpenAI Embeddings API
- é…ç½® Qwen å…¼å®¹çš„ base URL
- ä½¿ç”¨ text-embedding-v3 æ¨¡å‹

#### Agent Service (agent.service.ts)
- é›†æˆ ChatOpenAI
- æ·»åŠ çœŸå®çš„ LLM è°ƒç”¨é€»è¾‘
- å®ç°ä¸­æ–‡ RAG æç¤ºè¯
- æ·»åŠ é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶

### 3. âœ… çŸ¥è¯†åº“æœç´¢ä¼˜åŒ–
- ä»å‘é‡ç›¸ä¼¼åº¦æœç´¢æ”¹ä¸ºå…³é”®è¯æœç´¢ï¼ˆå…¼å®¹ JSON å­˜å‚¨æ ¼å¼ï¼‰
- ä¿ç•™å‘é‡åŒ–åŠŸèƒ½ï¼Œä¾¿äºå°†æ¥å‡çº§åˆ° pgvector

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: åŸºç¡€å¯¹è¯
```bash
Request: "What is AI?"
Response: "Artificial Intelligence (AI) refers to the simulation of human intelligence
in machines that are programmed to think, learn, and make decisions..."
```
**çŠ¶æ€**: âœ… **æˆåŠŸ** - Qwen LLM æ­£å¸¸å“åº”

### æµ‹è¯• 2: çŸ¥è¯†åº“ä¸Šä¼ 
```bash
File: test-doc.txt
Content: Aether Flow æ˜¯ä¸€ä¸ª AI Agent å·¥ä½œæµå¹³å°...
Result: âœ… æ–‡æ¡£å·²å‘é‡åŒ– (1536ç»´)
```
**çŠ¶æ€**: âœ… **æˆåŠŸ** - æ–‡æ¡£ä¸Šä¼ å¹¶ç”Ÿæˆ embedding

### æµ‹è¯• 3: çŸ¥è¯†åº“æ£€ç´¢
```bash
Query: "Vue3"
Result: Found 1 result in test-doc.txt
```
**çŠ¶æ€**: âœ… **æˆåŠŸ** - å…³é”®è¯æœç´¢æ­£å¸¸

---

## ğŸ¯ å½“å‰åŠŸèƒ½çŠ¶æ€

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| **LLM å¯¹è¯** | âœ… **å¯ç”¨** | Qwen æ­£å¸¸å“åº” |
| **æ–‡æ¡£ä¸Šä¼ ** | âœ… **å¯ç”¨** | æ”¯æŒæ–‡æœ¬æ–‡ä»¶ |
| **æ–‡æœ¬å‘é‡åŒ–** | âœ… **å¯ç”¨** | ç”Ÿæˆ 1536 ç»´å‘é‡ |
| **å…³é”®è¯æœç´¢** | âœ… **å¯ç”¨** | åŸºäº LIKE æŸ¥è¯¢ |
| **RAG å›ç­”** | âš ï¸ **éƒ¨åˆ†** | LLM å¯ç”¨ï¼Œæœç´¢éœ€ä¼˜åŒ– |

---

## âš ï¸ å·²çŸ¥é™åˆ¶

### 1. æœç´¢ç²¾åº¦
**é—®é¢˜**: å½“å‰ä½¿ç”¨å…³é”®è¯æœç´¢ (`LIKE %query%`)ï¼Œä¸æ˜¯è¯­ä¹‰æœç´¢
**å½±å“**: å¦‚æœç”¨æˆ·æŸ¥è¯¢ä¸çŸ¥è¯†åº“è¯æ±‡ä¸å®Œå…¨åŒ¹é…ï¼Œæ— æ³•æ£€ç´¢åˆ°å†…å®¹
**è§£å†³æ–¹æ¡ˆ**:
```typescript
// å°†æ¥å¯ä»¥å‡çº§åˆ° pgvector å®ç°çœŸæ­£çš„è¯­ä¹‰æœç´¢
@Column({ type: 'vector', dimensions: 1536 })
```

### 2. ä¸­æ–‡ç¼–ç 
**é—®é¢˜**: ä¸­æ–‡æŸ¥è¯¢å¯èƒ½å­˜åœ¨ç¼–ç é—®é¢˜
**å½±å“**: éƒ¨åˆ†ä¸­æ–‡é—®é¢˜æ— æ³•æ­£ç¡®æ£€ç´¢
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿å‰ç«¯å’Œåç«¯ç»Ÿä¸€ä½¿ç”¨ UTF-8

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¯¹è¯æ¥å£
```bash
curl -X POST http://localhost:3001/agent/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"ä½ çš„é—®é¢˜"}'
```

### ä¸Šä¼ æ–‡æ¡£
```bash
curl -X POST http://localhost:3001/knowledge/upload \
  -F "file=@document.txt"
```

### æœç´¢çŸ¥è¯†åº“
```bash
curl "http://localhost:3001/knowledge/search?q=å…³é”®è¯"
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **LLM å“åº”æ—¶é—´**: ~2-5 ç§’
- **æ–‡æ¡£å‘é‡åŒ–**: ~3-8 ç§’ï¼ˆå–å†³äºæ–‡æœ¬é•¿åº¦ï¼‰
- **æœç´¢å“åº”**: <100 æ¯«ç§’
- **Embedding ç»´åº¦**: 1536
- **æ¨¡å‹**: qwen-flash (é˜¿é‡Œäº‘)

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### LLM æ— æ³•å“åº”
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec aether_backend env | grep OPENAI

# æŸ¥çœ‹æ—¥å¿—
docker logs aether_backend | grep "LLM initialized"
```

### çŸ¥è¯†åº“æœç´¢æ— ç»“æœ
```bash
# æ£€æŸ¥æ–‡æ¡£æ˜¯å¦ä¸Šä¼ æˆåŠŸ
curl http://localhost:3001/knowledge/search?q=test

# æŸ¥çœ‹æ•°æ®åº“
docker exec -it aether_db psql -U admin -d aether_flow -c "SELECT * FROM knowledge;"
```

---

## ğŸ“ æ”¹è¿›å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§
1. **ä¼˜åŒ–æœç´¢ç®—æ³•**
   - å®ç°æ··åˆæ£€ç´¢ï¼ˆå…³é”®è¯ + è¯­ä¹‰ï¼‰
   - æ·»åŠ ç›¸å…³æ€§è¯„åˆ†

2. **ä¸­æ–‡æ”¯æŒå¢å¼º**
   - æµ‹è¯•ä¸­æ–‡æŸ¥è¯¢å’Œæ£€ç´¢
   - ä¼˜åŒ–ç¼–ç å¤„ç†

### ğŸŸ  ä¸­ä¼˜å…ˆçº§
3. **æ·»åŠ æµå¼ä¼ è¾“**
   - å®ç° SSE æµå¼è¾“å‡º
   - æå‡ç”¨æˆ·ä½“éªŒ

4. **ä¼šè¯ç®¡ç†**
   - å®ç° Session History
   - æ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡

---

## ğŸ‰ æ€»ç»“

âœ… **Qwen API é…ç½®æˆåŠŸï¼**
âœ… **LLM æ­£å¸¸å·¥ä½œï¼**
âœ… **çŸ¥è¯†åº“åŠŸèƒ½å¯ç”¨ï¼**
âš ï¸ **æœç´¢ç®—æ³•éœ€è¦ä¼˜åŒ–**

**é¡¹ç›®å®Œæˆåº¦**: ä» 70% â†’ **85%**

ç°åœ¨ä½ æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ AI Agent å¹³å°ï¼ŒåŒ…æ‹¬ï¼š
- å¯è§†åŒ–å·¥ä½œæµç¼–æ’
- çŸ¥è¯†åº“ç®¡ç†ï¼ˆæ”¯æŒä¸Šä¼ å’Œå‘é‡åŒ–ï¼‰
- æ™ºèƒ½ Agentï¼ˆä½¿ç”¨ Qwen LLMï¼‰
- RAG æ£€ç´¢ï¼ˆå…³é”®è¯æœç´¢ï¼‰

å¯ä»¥å¼€å§‹æ„å»ºä½ çš„ AI åº”ç”¨äº†ï¼ğŸš€
